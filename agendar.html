<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendar Consulta</title>
    <link rel="stylesheet" href="css/agendar.css">
</head>
<body>
    <div class="container">
        <section class="selecao-pet">
            <label>Selecione o pet:</label>
            <select class="lista-selecao" id="selectPet">
                <option value="">Selecione um pet</option>
            </select>
        </section>

        <section class="selecao-tipo">
            <label>Selecione o tipo:</label>
            <select class="lista-selecao">
                <option selected>Consulta</option>
                <option>Vacina</option>
                <option>Banho</option>
                <option>Tosa</option>
            </select>
        </section>

        <section class="selecao-clinica">
            <label>Selecione a clínica:</label>
            <select class="lista-selecao" id="selectClinica">
                <option value="DIAMANTE">DIAMANTE</option>
                <option value="PETCURE">PETCURE</option>
                <option value="CATCARE">CATCARE</option>
                <option value="DOG E SAUDE">DOG E SAUDE</option>
            </select>
        </section>

        <section class="selecao-data">
            <p>Selecione a data:</p>
            <br>
            <div class="calendario">
                <div class="cabecalho-calendario">
                    <button class="botao-nav anterior">&lt;</button>
                    <div class="mes-atual">
                        <h2>Dezembro</h2>
                        <span>2024</span>
                    </div>
                    <button class="botao-nav proximo">&gt;</button>
                </div>
                <div class="dias-semana">
                    <span>Dom</span>
                    <span>Seg</span>
                    <span>Ter</span>
                    <span>Qua</span>
                    <span>Qui</span>
                    <span>Sex</span>
                    <span>Sab</span>
                </div>
                <div class="grid-calendario" id="diasCalendario"></div>
            </div>
        </section>

        <section class="selecao-horario">
            <h3>Horários disponíveis</h3>
            <div class="grid-horarios">
                <button class="botao-horario">8:00</button>
                <button class="botao-horario">9:00</button>
                <button class="botao-horario">11:00</button>
                
        </section>

        <button class="botao-agendar">Marcar consulta</button>

        <nav class="menu-navegacao">
            <a href="index.html">
                <img src="src/home.png" alt="Início">
                
            </a>
            <a href="animal.html">
                <img src="src/dog.png" alt="Pets">
                
            </a>
            <a href="agendamentos.html">
                <img src="src/calendar.png" alt="Agenda">
                
            </a>
        </nav>
    </div>
    
    <script>
        
        const dadosAgendamento = {
            dataSelecionada: null,
            horarioSelecionado: null,
            mesAtual: 11,
            anoAtual: 2024,
            meses: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                    'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro']
        };

        function carregarPets() {
            const listaPets = JSON.parse(localStorage.getItem('pets')) || [];
            const selectPet = document.getElementById('selectPet');
            
            selectPet.innerHTML = '<option value="">Selecione um pet</option>';
            listaPets.forEach(pet => {
                selectPet.innerHTML += `<option value="${pet.id}">${pet.name}</option>`;
            });
        }

        function prepararCalendario() {
            atualizarMesAno();
            criarDiasCalendario();
        }

        function atualizarMesAno() {
            document.querySelector('.mes-atual h2').textContent = dadosAgendamento.meses[dadosAgendamento.mesAtual];
            document.querySelector('.mes-atual span').textContent = dadosAgendamento.anoAtual;
        }

        function criarDiasCalendario() {
            const primeiroDia = new Date(dadosAgendamento.anoAtual, dadosAgendamento.mesAtual, 1);
            const ultimoDia = new Date(dadosAgendamento.anoAtual, dadosAgendamento.mesAtual + 1, 0);
            const gridCalendario = document.getElementById('diasCalendario');
            
            gridCalendario.innerHTML = '';
            
            for (let i = 0; i < primeiroDia.getDay(); i++) {
                gridCalendario.innerHTML += '<button class="botao-data desativado"></button>';
            }
            
            for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
                gridCalendario.innerHTML += `<button class="botao-data">${dia}</button>`;
            }
        }

        function configurarBotoes() {
            document.querySelector('.anterior').onclick = () => mudarMes(-1);
            document.querySelector('.proximo').onclick = () => mudarMes(1);
            
            document.getElementById('diasCalendario').onclick = (evento) => {
                if (evento.target.classList.contains('botao-data') && !evento.target.classList.contains('desativado')) {
                    document.querySelectorAll('.botao-data').forEach(botao => botao.classList.remove('selecionado'));
                    evento.target.classList.add('selecionado');
                    dadosAgendamento.dataSelecionada = evento.target.textContent;
                }
            };

            document.querySelectorAll('.botao-horario').forEach(botao => {
                botao.onclick = (evento) => {
                    document.querySelectorAll('.botao-horario').forEach(b => b.classList.remove('selecionado'));
                    evento.target.classList.add('selecionado');
                    dadosAgendamento.horarioSelecionado = evento.target.textContent;
                };
            });

            document.querySelector('.botao-agendar').onclick = fazerAgendamento;
        }

        function mudarMes(direcao) {
            dadosAgendamento.mesAtual += direcao;
            
            if (dadosAgendamento.mesAtual > 11) {
                dadosAgendamento.mesAtual = 0;
                dadosAgendamento.anoAtual++;
            } else if (dadosAgendamento.mesAtual < 0) {
                dadosAgendamento.mesAtual = 11;
                dadosAgendamento.anoAtual--;
            }
            
            prepararCalendario();
        }

        function fazerAgendamento() {
            const petSelecionado = document.getElementById('selectPet');
            const clinicaSelecionada = document.getElementById('selectClinica');
            
            if (!petSelecionado.value) {
                alert('Por favor selecione um pet');
                return;
            }
            
            if (!dadosAgendamento.dataSelecionada || !dadosAgendamento.horarioSelecionado) {
                alert('Por favor selecione uma data e horário');
                return;
            }
            
            alert(`Consulta agendada para ${petSelecionado.options[petSelecionado.selectedIndex].text} 
                   na ${clinicaSelecionada.value} para 
                   ${dadosAgendamento.dataSelecionada}/${dadosAgendamento.mesAtual + 1}/${dadosAgendamento.anoAtual} 
                   às ${dadosAgendamento.horarioSelecionado}`);
        }

        window.onload = function() {
            carregarPets();
            prepararCalendario();
            configurarBotoes();
            
            const params = new URLSearchParams(window.location.search);
            const clinica = params.get('clinica');
            if(clinica) {
                document.getElementById('selectClinica').value = clinica;
            }
        };
    </script>
</body>
</html>
